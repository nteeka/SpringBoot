<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Qu·∫£n l√Ω Kho & Nh·∫≠p H√†ng | GreenLife Admin</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #f5f7fa;
        margin-left: 250px;
      }

      .main-content {
        padding: 2rem;
        min-height: 100vh;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }

      .header h1 {
        font-size: 2rem;
        color: #2c3e50;
      }

      .header-actions {
        display: flex;
        gap: 1rem;
      }

      .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 8px;
        font-size: 0.95rem;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      .btn-success {
        background: #27ae60;
        color: white;
      }

      .btn-success:hover {
        background: #229954;
      }

      .btn-warning {
        background: #f39c12;
        color: white;
      }

      .btn-warning:hover {
        background: #e67e22;
      }

      .btn-secondary {
        background: #ecf0f1;
        color: #2c3e50;
      }

      .btn-secondary:hover {
        background: #dfe6e9;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .stat-card {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        transition: transform 0.3s, box-shadow 0.3s;
        cursor: pointer;
      }

      .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
      }

      .stat-card.warning {
        border-left: 4px solid #f39c12;
      }

      .stat-card.danger {
        border-left: 4px solid #e74c3c;
      }

      .stat-card.success {
        border-left: 4px solid #27ae60;
      }

      .stat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.8rem;
      }

      .stat-icon {
        font-size: 2rem;
      }

      .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: #2c3e50;
      }

      .stat-label {
        color: #7f8c8d;
        font-size: 0.9rem;
        margin-top: 0.5rem;
      }

      .content-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        overflow: hidden;
      }

      .card-header {
        padding: 1.5rem;
        border-bottom: 1px solid #ecf0f1;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .card-header h2 {
        color: #2c3e50;
        font-size: 1.3rem;
      }

      .card-body {
        padding: 1.5rem;
      }

      .table-wrapper {
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th {
        background: #f8f9fa;
        padding: 1rem;
        text-align: left;
        font-weight: 600;
        color: #2c3e50;
        font-size: 0.9rem;
        text-transform: uppercase;
      }

      td {
        padding: 1rem;
        border-bottom: 1px solid #ecf0f1;
        color: #2c3e50;
      }

      tr:hover {
        background: #f8f9fa;
      }

      .product-info {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .product-image {
        width: 50px;
        height: 50px;
        border-radius: 8px;
        object-fit: cover;
      }

      .product-name {
        font-weight: 600;
        color: #2c3e50;
      }

      .product-sku {
        font-size: 0.85rem;
        color: #7f8c8d;
      }

      .stock-badge {
        padding: 0.4rem 0.8rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        display: inline-block;
      }

      .stock-low {
        background: #fff3cd;
        color: #856404;
      }

      .stock-out {
        background: #f8d7da;
        color: #721c24;
      }

      .stock-good {
        background: #d4edda;
        color: #155724;
      }

      .btn-icon {
        padding: 0.5rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.3s;
      }

      .btn-edit {
        background: #e3f2fd;
        color: #1976d2;
      }

      .btn-edit:hover {
        background: #1976d2;
        color: white;
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: #2c3e50;
        font-weight: 500;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #dfe6e9;
        border-radius: 8px;
        font-size: 0.95rem;
        font-family: inherit;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }

      .activity-list {
        max-height: 400px;
        overflow-y: auto;
      }

      .activity-item {
        padding: 1rem;
        border-bottom: 1px solid #ecf0f1;
        display: flex;
        gap: 1rem;
      }

      .activity-item:last-child {
        border-bottom: none;
      }

      .activity-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        flex-shrink: 0;
      }

      .activity-icon.in {
        background: #d4edda;
      }

      .activity-icon.out {
        background: #f8d7da;
      }

      .activity-icon.adjust {
        background: #fff3cd;
      }

      .activity-content {
        flex: 1;
      }

      .activity-title {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 0.3rem;
      }

      .activity-detail {
        font-size: 0.85rem;
        color: #7f8c8d;
      }

      .activity-time {
        font-size: 0.8rem;
        color: #95a5a6;
        margin-top: 0.3rem;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        align-items: center;
        justify-content: center;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: white;
        border-radius: 12px;
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      }

      .modal-header {
        padding: 1.5rem;
        border-bottom: 1px solid #ecf0f1;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-header h3 {
        color: #2c3e50;
        font-size: 1.5rem;
      }

      .close-modal {
        font-size: 1.5rem;
        cursor: pointer;
        color: #7f8c8d;
        background: none;
        border: none;
        padding: 0.5rem;
      }

      .close-modal:hover {
        color: #2c3e50;
      }

      .modal-body {
        padding: 1.5rem;
      }

      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        z-index: 3000;
        display: none;
        align-items: center;
        gap: 0.8rem;
        animation: slideIn 0.3s ease-out;
      }

      .notification.active {
        display: flex;
      }

      .notification.success {
        border-left: 4px solid #27ae60;
      }

      .notification.error {
        border-left: 4px solid #e74c3c;
      }

      @keyframes slideIn {
        from {
          transform: translateX(400px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .alert {
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
      }

      .alert-warning {
        background: #fff3cd;
        border-left: 4px solid #f39c12;
        color: #856404;
      }

      .alert-info {
        background: #d1ecf1;
        border-left: 4px solid #17a2b8;
        color: #0c5460;
      }

      .supplier-card {
        background: #f8f9fa;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
      }

      .supplier-name {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 0.5rem;
      }

      .supplier-info {
        font-size: 0.9rem;
        color: #7f8c8d;
      }

      @media (max-width: 768px) {
        .main-content {
          padding: 1rem;
        }

        .content-grid {
          grid-template-columns: 1fr;
        }

        .form-row {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div th:replace="Page/Admin/sidebarAdmin :: sidebarAdmin"></div>
    <!-- Notification -->
    <div class="notification" id="notification">
      <span id="notificationIcon"></span>
      <span id="notificationMessage"></span>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Header -->
      <div class="header">
        <h1>üì¶ Qu·∫£n l√Ω Kho & Nh·∫≠p H√†ng</h1>
        <div class="header-actions">
          <button class="btn btn-success" onclick="openImportModal()">
            ‚ûï Nh·∫≠p h√†ng m·ªõi
          </button>
          <button class="btn btn-warning" onclick="openStockCheckModal()">
            üìã Ki·ªÉm k√™ kho
          </button>
          <button class="btn btn-primary" onclick="exportInventoryReport()">
            üìä Xu·∫•t b√°o c√°o
          </button>
        </div>
      </div>

      <!-- Stats Grid -->
      <div class="stats-grid">
        <div class="stat-card success">
          <div class="stat-header">
            <span class="stat-icon">üì¶</span>
          </div>
          <div class="stat-value" id="totalProducts">156</div>
          <div class="stat-label">T·ªïng s·ªë s·∫£n ph·∫©m</div>
        </div>
        <div class="stat-card warning">
          <div class="stat-header">
            <span class="stat-icon">‚ö†Ô∏è</span>
          </div>
          <div class="stat-value" id="lowStockProducts">12</div>
          <div class="stat-label">S·∫Øp h·∫øt h√†ng</div>
        </div>
        <div class="stat-card danger">
          <div class="stat-header">
            <span class="stat-icon">‚ùå</span>
          </div>
          <div class="stat-value" id="outOfStockProducts">5</div>
          <div class="stat-label">H·∫øt h√†ng</div>
        </div>
        <div class="stat-card">
          <div class="stat-header">
            <span class="stat-icon">üí∞</span>
          </div>
          <div class="stat-value" id="inventoryValue">2.5B</div>
          <div class="stat-label">Gi√° tr·ªã kho h√†ng</div>
        </div>
      </div>

      <!-- Alerts -->
      <div class="alert alert-warning" id="lowStockAlert">
        ‚ö†Ô∏è <strong>C·∫£nh b√°o:</strong> C√≥ 12 s·∫£n ph·∫©m s·∫Øp h·∫øt h√†ng. Vui l√≤ng nh·∫≠p
        th√™m h√†ng!
      </div>

      <!-- Content Grid -->
      <div class="content-grid">
        <!-- Inventory Table -->
        <div class="card">
          <div class="card-header">
            <h2>T·ªìn kho hi·ªán t·∫°i</h2>
            <div style="display: flex; gap: 0.5rem">
              <select
                id="stockFilter"
                onchange="filterInventory()"
                style="
                  padding: 0.5rem;
                  border-radius: 6px;
                  border: 1px solid #dfe6e9;
                "
              >
                <option value="all">T·∫•t c·∫£</option>
                <option value="low">S·∫Øp h·∫øt h√†ng</option>
                <option value="out">H·∫øt h√†ng</option>
              </select>
            </div>
          </div>
          <div class="card-body">
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>S·∫£n ph·∫©m</th>
                    <th>SKU</th>
                    <th>T·ªìn kho</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>Gi√° nh·∫≠p</th>
                    <th>Thao t√°c</th>
                  </tr>
                </thead>
                <tbody id="inventoryTableBody">
                  <!-- Will be populated by JS -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Recent Activities -->
        <div class="card">
          <div class="card-header">
            <h2>Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y</h2>
          </div>
          <div class="card-body" style="padding: 0">
            <div class="activity-list" id="activityList">
              <!-- Will be populated by JS -->
            </div>
          </div>
        </div>
      </div>

      <!-- Suppliers Section -->
      <div class="card">
        <div class="card-header">
          <h2>üè™ Nh√† cung c·∫•p</h2>
          <button class="btn btn-primary" onclick="openSupplierModal()">
            ‚ûï Th√™m nh√† cung c·∫•p
          </button>
        </div>
        <div class="card-body">
          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
              gap: 1rem;
            "
            id="suppliersList"
          >
            <!-- Will be populated by JS -->
          </div>
        </div>
      </div>
    </div>

    <!-- Import Stock Modal -->
    <div class="modal" id="importModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>‚ûï Nh·∫≠p h√†ng m·ªõi</h3>
          <button class="close-modal" onclick="closeImportModal()">‚úï</button>
        </div>
        <div class="modal-body">
          <form id="importForm">
            <div class="form-group">
              <label>Ch·ªçn s·∫£n ph·∫©m *</label>
              <select id="importProduct" required>
                <option value="">-- Ch·ªçn s·∫£n ph·∫©m --</option>
              </select>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>S·ªë l∆∞·ª£ng nh·∫≠p *</label>
                <input
                  type="number"
                  id="importQuantity"
                  min="1"
                  required
                  placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng"
                />
              </div>
              <div class="form-group">
                <label>Gi√° nh·∫≠p (VNƒê) *</label>
                <input
                  type="number"
                  id="importPrice"
                  min="0"
                  required
                  placeholder="Nh·∫≠p gi√°"
                />
              </div>
            </div>

            <div class="form-group">
              <label>Nh√† cung c·∫•p *</label>
              <select id="importSupplier" required>
                <option value="">-- Ch·ªçn nh√† cung c·∫•p --</option>
              </select>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Ng√†y nh·∫≠p *</label>
                <input type="date" id="importDate" required />
              </div>
              <div class="form-group">
                <label>M√£ phi·∫øu nh·∫≠p</label>
                <input type="text" id="importCode" placeholder="T·ª± ƒë·ªông t·∫°o" />
              </div>
            </div>

            <div class="form-group">
              <label>Ghi ch√∫</label>
              <textarea
                id="importNote"
                rows="3"
                placeholder="Nh·∫≠p ghi ch√∫ n·∫øu c√≥..."
              ></textarea>
            </div>

            <div style="display: flex; gap: 0.5rem; margin-top: 1.5rem">
              <button type="submit" class="btn btn-success" style="flex: 1">
                ‚úì X√°c nh·∫≠n nh·∫≠p h√†ng
              </button>
              <button
                type="button"
                class="btn btn-secondary"
                onclick="closeImportModal()"
                style="flex: 1"
              >
                ‚úï H·ªßy
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Stock Adjustment Modal -->
    <div class="modal" id="adjustModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>üìù ƒêi·ªÅu ch·ªânh t·ªìn kho</h3>
          <button class="close-modal" onclick="closeAdjustModal()">‚úï</button>
        </div>
        <div class="modal-body">
          <form id="adjustForm">
            <div class="alert alert-info">
              S·∫£n ph·∫©m: <strong id="adjustProductName"></strong><br />
              T·ªìn kho hi·ªán t·∫°i: <strong id="adjustCurrentStock"></strong>
            </div>

            <div class="form-group">
              <label>Lo·∫°i ƒëi·ªÅu ch·ªânh *</label>
              <select id="adjustType" required onchange="updateAdjustLabel()">
                <option value="add">‚ûï Th√™m v√†o kho</option>
                <option value="subtract">‚ûñ Tr·ª´ kh·ªèi kho</option>
                <option value="set">üìå ƒê·∫∑t s·ªë l∆∞·ª£ng c·ªë ƒë·ªãnh</option>
              </select>
            </div>

            <div class="form-group">
              <label id="adjustQuantityLabel">S·ªë l∆∞·ª£ng th√™m *</label>
              <input
                type="number"
                id="adjustQuantity"
                min="0"
                required
                placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng"
              />
            </div>

            <div class="form-group">
              <label>L√Ω do ƒëi·ªÅu ch·ªânh *</label>
              <select id="adjustReason" required>
                <option value="">-- Ch·ªçn l√Ω do --</option>
                <option value="damaged">H√†ng h·ªèng</option>
                <option value="lost">Th·∫•t tho√°t</option>
                <option value="return">Tr·∫£ h√†ng</option>
                <option value="inventory">Ki·ªÉm k√™ ph√°t hi·ªán sai l·ªách</option>
                <option value="other">Kh√°c</option>
              </select>
            </div>

            <div class="form-group">
              <label>Ghi ch√∫ chi ti·∫øt</label>
              <textarea
                id="adjustNote"
                rows="3"
                placeholder="M√¥ t·∫£ chi ti·∫øt l√Ω do ƒëi·ªÅu ch·ªânh..."
              ></textarea>
            </div>

            <div style="display: flex; gap: 0.5rem; margin-top: 1.5rem">
              <button type="submit" class="btn btn-warning" style="flex: 1">
                ‚úì X√°c nh·∫≠n ƒëi·ªÅu ch·ªânh
              </button>
              <button
                type="button"
                class="btn btn-secondary"
                onclick="closeAdjustModal()"
                style="flex: 1"
              >
                ‚úï H·ªßy
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Add Supplier Modal -->
    <div class="modal" id="supplierModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>üè™ Th√™m nh√† cung c·∫•p</h3>
          <button class="close-modal" onclick="closeSupplierModal()">‚úï</button>
        </div>
        <div class="modal-body">
          <form id="supplierForm">
            <div class="form-group">
              <label>T√™n nh√† cung c·∫•p *</label>
              <input
                type="text"
                id="supplierName"
                required
                placeholder="Nh·∫≠p t√™n nh√† cung c·∫•p"
              />
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Ng∆∞·ªùi li√™n h·ªá *</label>
                <input
                  type="text"
                  id="supplierContact"
                  required
                  placeholder="T√™n ng∆∞·ªùi li√™n h·ªá"
                />
              </div>
              <div class="form-group">
                <label>S·ªë ƒëi·ªán tho·∫°i *</label>
                <input
                  type="tel"
                  id="supplierPhone"
                  required
                  placeholder="S·ªë ƒëi·ªán tho·∫°i"
                />
              </div>
            </div>

            <div class="form-group">
              <label>Email</label>
              <input
                type="email"
                id="supplierEmail"
                placeholder="Email li√™n h·ªá"
              />
            </div>

            <div class="form-group">
              <label>ƒê·ªãa ch·ªâ</label>
              <textarea
                id="supplierAddress"
                rows="2"
                placeholder="ƒê·ªãa ch·ªâ nh√† cung c·∫•p"
              ></textarea>
            </div>

            <div class="form-group">
              <label>Ghi ch√∫</label>
              <textarea
                id="supplierNote"
                rows="2"
                placeholder="Ghi ch√∫ v·ªÅ nh√† cung c·∫•p..."
              ></textarea>
            </div>

            <div style="display: flex; gap: 0.5rem; margin-top: 1.5rem">
              <button type="submit" class="btn btn-success" style="flex: 1">
                ‚úì Th√™m nh√† cung c·∫•p
              </button>
              <button
                type="button"
                class="btn btn-secondary"
                onclick="closeSupplierModal()"
                style="flex: 1"
              >
                ‚úï H·ªßy
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      // Sample Data
      const inventoryData = [
        {
          id: 1,
          name: "C√¢y Kim Ti·ªÅn",
          sku: "CKT001",
          stock: 45,
          minStock: 10,
          importPrice: 180000,
          image:
            "https://images.unsplash.com/photo-1509937528035-ad76254b0356?w=100",
        },
        {
          id: 2,
          name: "C√¢y Tr·∫ßu B√†",
          sku: "CTB001",
          stock: 8,
          minStock: 10,
          importPrice: 120000,
          image:
            "https://images.unsplash.com/photo-1614594975525-e45190c55d0b?w=100",
        },
        {
          id: 3,
          name: "Hoa H·ªìng Ecuador",
          sku: "HHE001",
          stock: 0,
          minStock: 20,
          importPrice: 280000,
          image:
            "https://images.unsplash.com/photo-1518709268805-4e9042af9f23?w=100",
        },
        {
          id: 4,
          name: "C√¢y Ph√°t T√†i",
          sku: "CPT001",
          stock: 32,
          minStock: 15,
          importPrice: 350000,
          image:
            "https://images.unsplash.com/photo-1463154545680-d59320fd685d?w=100",
        },
        {
          id: 5,
          name: "C√¢y L∆∞·ª°i H·ªï",
          sku: "CLH001",
          stock: 6,
          minStock: 10,
          importPrice: 90000,
          image:
            "https://images.unsplash.com/photo-1591958911259-bee2173bdccc?w=100",
        },
      ];

      const activities = [
        {
          type: "in",
          title: "Nh·∫≠p h√†ng",
          detail: "Nh·∫≠p 50 C√¢y Kim Ti·ªÅn t·ª´ NCC ƒê√† L·∫°t Farm",
          time: "2 gi·ªù tr∆∞·ªõc",
          icon: "üì•",
        },
        {
          type: "out",
          title: "Xu·∫•t h√†ng",
          detail: "Xu·∫•t 15 Hoa H·ªìng cho ƒë∆°n DH001",
          time: "3 gi·ªù tr∆∞·ªõc",
          icon: "üì§",
        },
        {
          type: "adjust",
          title: "ƒêi·ªÅu ch·ªânh t·ªìn kho",
          detail: "Tr·ª´ 5 C√¢y Tr·∫ßu B√† - L√Ω do: H√†ng h·ªèng",
          time: "5 gi·ªù tr∆∞·ªõc",
          icon: "‚öôÔ∏è",
        },
        {
          type: "in",
          title: "Nh·∫≠p h√†ng",
          detail: "Nh·∫≠p 100 C√¢y L∆∞·ª°i H·ªï t·ª´ NCC S√†i G√≤n Green",
          time: "1 ng√†y tr∆∞·ªõc",
          icon: "üì•",
        },
        {
          type: "adjust",
          title: "Ki·ªÉm k√™ kho",
          detail: "ƒêi·ªÅu ch·ªânh s·ªë l∆∞·ª£ng sau ki·ªÉm k√™ ƒë·ªãnh k·ª≥",
          time: "2 ng√†y tr∆∞·ªõc",
          icon: "üìã",
        },
      ];

      const suppliers = [
        {
          id: 1,
          name: "ƒê√† L·∫°t Farm",
          contact: "Nguy·ªÖn VƒÉn A",
          phone: "0901234567",
          email: "contact@dalatfarm.com",
          address: "ƒê√† L·∫°t, L√¢m ƒê·ªìng",
        },
        {
          id: 2,
          name: "S√†i G√≤n Green",
          contact: "Tr·∫ßn Th·ªã B",
          phone: "0912345678",
          email: "info@saigongreen.vn",
          address: "Qu·∫≠n 12, TP.HCM",
        },
        {
          id: 3,
          name: "Hoa T∆∞∆°i Mi·ªÅn B·∫Øc",
          contact: "L√™ VƒÉn C",
          phone: "0923456789",
          email: "hoatuoi@gmail.com",
          address: "H√† N·ªôi",
        },
      ];

      let currentAdjustProduct = null;

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        loadInventory();
        loadActivities();
        loadSuppliers();
        populateProductSelect();
        populateSupplierSelect();
        updateStats();
        setTodayDate();
      });

      // Load inventory table
      function loadInventory() {
        const tbody = document.getElementById("inventoryTableBody");
        const filter = document.getElementById("stockFilter").value;

        let filteredData = inventoryData;
        if (filter === "low") {
          filteredData = inventoryData.filter(
            (p) => p.stock > 0 && p.stock <= p.minStock
          );
        } else if (filter === "out") {
          filteredData = inventoryData.filter((p) => p.stock === 0);
        }

        tbody.innerHTML = filteredData
          .map((product) => {
            const stockStatus = getStockStatus(product.stock, product.minStock);
            return `
            <tr>
              <td>
                <div class="product-info">
                  <img src="${product.image}" alt="${
              product.name
            }" class="product-image">
                  <div>
                    <div class="product-name">${product.name}</div>
                  </div>
                </div>
              </td>
              <td class="product-sku">${product.sku}</td>
              <td><strong>${product.stock}</strong></td>
              <td><span class="stock-badge stock-${stockStatus.class}">${
              stockStatus.text
            }</span></td>
              <td>${formatCurrency(product.importPrice)}</td>
              <td>
                <button class="btn-icon btn-edit" onclick="openAdjustModal(${
                  product.id
                })" title="ƒêi·ªÅu ch·ªânh t·ªìn kho">
                  ‚öôÔ∏è
                </button>
              </td>
            </tr>
          `;
          })
          .join("");
      }

      // Load activities
      function loadActivities() {
        const list = document.getElementById("activityList");
        list.innerHTML = activities
          .map(
            (activity) => `
          <div class="activity-item">
            <div class="activity-icon ${activity.type}">
              ${activity.icon}
            </div>
            <div class="activity-content">
              <div class="activity-title">${activity.title}</div>
              <div class="activity-detail">${activity.detail}</div>
              <div class="activity-time">${activity.time}</div>
            </div>
          </div>
        `
          )
          .join("");
      }

      // Load suppliers
      function loadSuppliers() {
        const list = document.getElementById("suppliersList");
        list.innerHTML = suppliers
          .map(
            (supplier) => `
          <div class="supplier-card">
            <div class="supplier-name">üè™ ${supplier.name}</div>
            <div class="supplier-info">
              üë§ ${supplier.contact}<br>
              üìû ${supplier.phone}<br>
              üìß ${supplier.email}<br>
              üìç ${supplier.address}
            </div>
          </div>
        `
          )
          .join("");
      }

      // Populate product select
      function populateProductSelect() {
        const select = document.getElementById("importProduct");
        select.innerHTML =
          '<option value="">-- Ch·ªçn s·∫£n ph·∫©m --</option>' +
          inventoryData
            .map((p) => `<option value="${p.id}">${p.name} (${p.sku})</option>`)
            .join("");
      }

      // Populate supplier select
      function populateSupplierSelect() {
        const select = document.getElementById("importSupplier");
        select.innerHTML =
          '<option value="">-- Ch·ªçn nh√† cung c·∫•p --</option>' +
          suppliers
            .map((s) => `<option value="${s.id}">${s.name}</option>`)
            .join("");
      }

      // Update statistics
      function updateStats() {
        const totalProducts = inventoryData.length;
        const lowStock = inventoryData.filter(
          (p) => p.stock > 0 && p.stock <= p.minStock
        ).length;
        const outOfStock = inventoryData.filter((p) => p.stock === 0).length;
        const totalValue = inventoryData.reduce(
          (sum, p) => sum + p.stock * p.importPrice,
          0
        );

        document.getElementById("totalProducts").textContent = totalProducts;
        document.getElementById("lowStockProducts").textContent = lowStock;
        document.getElementById("outOfStockProducts").textContent = outOfStock;
        document.getElementById("inventoryValue").textContent =
          formatValue(totalValue);

        // Show/hide alert
        const alert = document.getElementById("lowStockAlert");
        if (lowStock > 0 || outOfStock > 0) {
          alert.style.display = "block";
          alert.innerHTML = `‚ö†Ô∏è <strong>C·∫£nh b√°o:</strong> C√≥ ${lowStock} s·∫£n ph·∫©m s·∫Øp h·∫øt h√†ng${
            outOfStock > 0 ? ` v√† ${outOfStock} s·∫£n ph·∫©m ƒë√£ h·∫øt h√†ng` : ""
          }. Vui l√≤ng nh·∫≠p th√™m h√†ng!`;
        } else {
          alert.style.display = "none";
        }
      }

      // Get stock status
      function getStockStatus(stock, minStock) {
        if (stock === 0) {
          return { class: "out", text: "‚ùå H·∫øt h√†ng" };
        } else if (stock <= minStock) {
          return { class: "low", text: "‚ö†Ô∏è S·∫Øp h·∫øt" };
        } else {
          return { class: "good", text: "‚úÖ ƒê·ªß h√†ng" };
        }
      }

      // Filter inventory
      function filterInventory() {
        loadInventory();
      }

      // Open import modal
      function openImportModal() {
        document.getElementById("importModal").classList.add("active");
      }

      // Close import modal
      function closeImportModal() {
        document.getElementById("importModal").classList.remove("active");
        document.getElementById("importForm").reset();
      }

      // Open adjust modal
      function openAdjustModal(productId) {
        const product = inventoryData.find((p) => p.id === productId);
        if (!product) return;

        currentAdjustProduct = product;
        document.getElementById("adjustProductName").textContent = product.name;
        document.getElementById("adjustCurrentStock").textContent =
          product.stock;
        document.getElementById("adjustModal").classList.add("active");
      }

      // Close adjust modal
      function closeAdjustModal() {
        document.getElementById("adjustModal").classList.remove("active");
        document.getElementById("adjustForm").reset();
        currentAdjustProduct = null;
      }

      // Update adjust label
      function updateAdjustLabel() {
        const type = document.getElementById("adjustType").value;
        const label = document.getElementById("adjustQuantityLabel");

        if (type === "add") {
          label.textContent = "S·ªë l∆∞·ª£ng th√™m *";
        } else if (type === "subtract") {
          label.textContent = "S·ªë l∆∞·ª£ng tr·ª´ *";
        } else {
          label.textContent = "S·ªë l∆∞·ª£ng m·ªõi *";
        }
      }

      // Open supplier modal
      function openSupplierModal() {
        document.getElementById("supplierModal").classList.add("active");
      }

      // Close supplier modal
      function closeSupplierModal() {
        document.getElementById("supplierModal").classList.remove("active");
        document.getElementById("supplierForm").reset();
      }

      // Open stock check modal
      function openStockCheckModal() {
        showNotification(
          "success",
          "T√≠nh nƒÉng ki·ªÉm k√™ kho ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn..."
        );
      }

      // Handle import form submission
      document
        .getElementById("importForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const productId = parseInt(
            document.getElementById("importProduct").value
          );
          const quantity = parseInt(
            document.getElementById("importQuantity").value
          );
          const price = parseFloat(
            document.getElementById("importPrice").value
          );
          const supplierId = parseInt(
            document.getElementById("importSupplier").value
          );
          const date = document.getElementById("importDate").value;
          const note = document.getElementById("importNote").value;

          const product = inventoryData.find((p) => p.id === productId);
          const supplier = suppliers.find((s) => s.id === supplierId);

          if (product && supplier) {
            // Update stock
            product.stock += quantity;
            product.importPrice = price;

            // Add activity
            activities.unshift({
              type: "in",
              title: "Nh·∫≠p h√†ng",
              detail: `Nh·∫≠p ${quantity} ${product.name} t·ª´ NCC ${supplier.name}`,
              time: "V·ª´a xong",
              icon: "üì•",
            });

            // Update UI
            loadInventory();
            loadActivities();
            updateStats();
            closeImportModal();
            showNotification(
              "success",
              `ƒê√£ nh·∫≠p ${quantity} ${product.name} v√†o kho th√†nh c√¥ng!`
            );
          }
        });

      // Handle adjust form submission
      document
        .getElementById("adjustForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          if (!currentAdjustProduct) return;

          const type = document.getElementById("adjustType").value;
          const quantity = parseInt(
            document.getElementById("adjustQuantity").value
          );
          const reason = document.getElementById("adjustReason").value;
          const note = document.getElementById("adjustNote").value;

          const oldStock = currentAdjustProduct.stock;
          let newStock = oldStock;

          if (type === "add") {
            newStock = oldStock + quantity;
          } else if (type === "subtract") {
            newStock = Math.max(0, oldStock - quantity);
          } else {
            newStock = quantity;
          }

          currentAdjustProduct.stock = newStock;

          // Add activity
          const reasonText = document.querySelector(
            `#adjustReason option[value="${reason}"]`
          ).textContent;
          activities.unshift({
            type: "adjust",
            title: "ƒêi·ªÅu ch·ªânh t·ªìn kho",
            detail: `${currentAdjustProduct.name}: ${oldStock} ‚Üí ${newStock} - L√Ω do: ${reasonText}`,
            time: "V·ª´a xong",
            icon: "‚öôÔ∏è",
          });

          // Update UI
          loadInventory();
          loadActivities();
          updateStats();
          closeAdjustModal();
          showNotification(
            "success",
            `ƒê√£ ƒëi·ªÅu ch·ªânh t·ªìn kho ${currentAdjustProduct.name} th√†nh c√¥ng!`
          );
        });

      // Handle supplier form submission
      document
        .getElementById("supplierForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const newSupplier = {
            id: suppliers.length + 1,
            name: document.getElementById("supplierName").value,
            contact: document.getElementById("supplierContact").value,
            phone: document.getElementById("supplierPhone").value,
            email: document.getElementById("supplierEmail").value,
            address: document.getElementById("supplierAddress").value,
          };

          suppliers.push(newSupplier);
          loadSuppliers();
          populateSupplierSelect();
          closeSupplierModal();
          showNotification(
            "success",
            `ƒê√£ th√™m nh√† cung c·∫•p ${newSupplier.name} th√†nh c√¥ng!`
          );
        });

      // Export inventory report
      function exportInventoryReport() {
        let csv =
          "SKU,T√™n s·∫£n ph·∫©m,T·ªìn kho,T·ªìn kho t·ªëi thi·ªÉu,Gi√° nh·∫≠p,Tr·∫°ng th√°i,Gi√° tr·ªã\n";

        inventoryData.forEach((product) => {
          const status = getStockStatus(product.stock, product.minStock);
          const value = product.stock * product.importPrice;
          csv += `${product.sku},${product.name},${product.stock},${product.minStock},${product.importPrice},${status.text},${value}\n`;
        });

        const blob = new Blob(["\ufeff" + csv], {
          type: "text/csv;charset=utf-8;",
        });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "bao_cao_ton_kho_" + new Date().getTime() + ".csv";
        a.click();

        showNotification("success", "ƒê√£ xu·∫•t b√°o c√°o t·ªìn kho th√†nh c√¥ng!");
      }

      // Set today date
      function setTodayDate() {
        const today = new Date().toISOString().split("T")[0];
        document.getElementById("importDate").value = today;
      }

      // Format currency
      function formatCurrency(amount) {
        return new Intl.NumberFormat("vi-VN", {
          style: "currency",
          currency: "VND",
        }).format(amount);
      }

      // Format value (B for billion, M for million)
      function formatValue(amount) {
        if (amount >= 1000000000) {
          return (amount / 1000000000).toFixed(1) + "B";
        } else if (amount >= 1000000) {
          return (amount / 1000000).toFixed(1) + "M";
        } else {
          return (amount / 1000).toFixed(0) + "K";
        }
      }

      // Show notification
      function showNotification(type, message) {
        const notification = document.getElementById("notification");
        const icon = document.getElementById("notificationIcon");
        const msg = document.getElementById("notificationMessage");

        notification.className = "notification " + type + " active";
        icon.textContent = type === "success" ? "‚úÖ" : "‚ùå";
        msg.textContent = message;

        setTimeout(() => {
          notification.classList.remove("active");
        }, 3000);
      }

      // Close modals when clicking outside
      document.querySelectorAll(".modal").forEach((modal) => {
        modal.addEventListener("click", function (e) {
          if (e.target === this) {
            this.classList.remove("active");
          }
        });
      });
    </script>
  </body>
</html>
